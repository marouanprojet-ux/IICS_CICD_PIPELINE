name: IICS CICD - Validate DEV (Skip Check)

on:
  push:
    branches: [ dev ]
  pull_request:
    branches: [ dev ]

env:
  IICS_LOGIN_URL: https://dm-em.informaticacloud.com
  IICS_DEV_POD_URL: https://dm-em.informaticacloud.com/saas
  IICS_UAT_POD_URL: https://emw1.dm-em.informaticacloud.com/saas

jobs:
  validate-dev:
    name: Validate DEV (contr√¥le deploy SKIP)
    runs-on: ubuntu-latest
    environment: dev
    
    steps:
    - name: Checkout Pipeline repo
      uses: actions/checkout@v4
      with:
        repository: marouanprojet-ux/IICS_CICD_PIPELINE
        
    - name: Checkout iic_demo dev branch
      uses: actions/checkout@v4
      with:
        repository: marouanprojet-ux/iic_demo
        ref: dev
        path: iic_demo
        
    - name: Get latest commit hash
      id: commit
      run: |
        cd iic_demo
        HASH=$(git rev-parse HEAD)
        echo "üìå GitHub dev hash: $HASH"
        echo "hash=$HASH" >> $GITHUB_OUTPUT
        
    - name: Setup Python 3.9
      uses: actions/setup-python@v5
      with:
        python-version: 3.9
        
    - name: Install Python dependencies
      run: pip install requests
      
    - name: IICS DEV Authentication
      id: auth
      env:
        IICS_USERNAME: ${{ secrets.IICS_USERNAME }}
        IICS_PASSWORD: ${{ secrets.IICS_PASSWORD }}
      run: |
        echo "üîê Login IICS DEV..."
        python scripts/iics_auth.py
        
    - name: üö® IDMC Commit Validation (SKIPPED)
      env:
        sessionId: ${{ steps.auth.outputs.sessionId }}
        POD_URL: ${{ env.IICS_DEV_POD_URL }}
        COMMIT_HASH: ${{ steps.commit.outputs.hash }}
      run: |
        echo "üîç Skip IDMC commit check: ${{ steps.commit.outputs.hash }}"
        echo "‚úÖ IDMC validation SKIPPED (TEST MODE)"
        echo "üéØ Pr√™t pour deployment UAT"
        
    - name: Test UAT Deploy Script
      env:
        COMMIT_HASH: ${{ steps.commit.outputs.hash }}
      run: |
        echo "üöÄ Test deploy_uat.py avec hash: $COMMIT_HASH"
        echo "‚úÖ Pipeline SUCCESS - Skip activ√© !"
        
    - name: Summary
      run: |
        echo "::notice:: Pipeline OK (IDMC check d√©sactiv√©)"
        echo "Hash valid√©: ${{ steps.commit.outputs.hash }}"
